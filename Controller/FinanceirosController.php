<?phpclass FinanceirosController extends AppController {    private $Financeiro = null;    private $Despesa = null;    private $Usuario = null;    public function __construct() {        parent::__construct();        $this->layout = 'painel';        $this->Financeiro = new Financeiro();        $this->Despesa = new Despesa();        $this->Usuario = new Usuario();    }    public function funcionario() {        $entradas = $this->Financeiro->filtrar($this->empresas_id, $this->pessoas_id, date('Y-m-01'), date('Y-m-t'), array(2, 3, 4, 5));        $urlPDF = "http://snappypdf.com.br/gerar.php?url=" . Router::url(array('Financeiros', 'imprimir', $this->pessoas_id, $this->empresas_id, date('Y-m-01'), date('Y-m-t')));        $this->set('title_layout', 'Financeiro: ' . Session::read('Usuario.nome'));        $this->set('entradas', $entradas);        $this->set('urlPDF', $urlPDF);        $this->render();    }    public function empresa() {        $usuariosEmpresa = array();        $funcionarioId = 0;        $entradas = $this->Financeiro->filtrar($this->empresas_id, null, date('Y-m-01'), date('Y-m-t'), array(2, 3, 4, 5));        $despesas = $this->Despesa->filtrar($this->empresas_id, date('Y-m-01'), date('Y-m-t'));        /**         * 	SE O ROLE ID FOR Usuario ELE PEGA SOMENTE O Usuario SE NÃ£oO OS USUARIOS DA EMPRESA         */        if (Session::read('Usuario.roles_id') == 4) {            $usuariosEmpresa = $this->Usuario->usuariosEmpresa($this->empresas_id, $this->pessoas_id);            $funcionarioId = $this->pessoas_id;        } else {            $usuariosEmpresa = $this->Usuario->usuariosEmpresa($this->empresas_id);        }        $urlPDF = "http://snappypdf.com.br/gerar.php?url=" . Router::url(array('Financeiros', 'imprimir', $funcionarioId, $this->empresas_id, date('Y-m-01'), date('Y-m-t')));        $this->set('title_layout', 'Financeiro: ' . Session::read('Usuario.nome_fantasia'));        $this->set('entradas', $entradas);        $this->set('despesas', $despesas);        $this->set('urlPDF', $urlPDF);        $this->set('profissionais', $usuariosEmpresa);        $this->render();    }    public function sistema() {            }    public function imprimir() {        $this->layout = 'imprimir';        $despesas = null;        list($pessoasId, $empresaId, $dataInicio, $dataFim) = explode('/', $_GET['param']);        $empresa = new Empresa();        $dadosEmpresa = $empresa->find('all', array('id' => $empresaId), array('logo', 'nome_fantasia', 'razao'));        $entradas = $this->Financeiro->filtrar($empresaId, $pessoasId, $dataInicio, $dataFim, array(2, 3, 4, 5));        if (empty($pessoasId)) {            $despesas = $this->Despesa->filtrar($empresaId, $dataInicio, $dataFim);        }        $this->set('dadosEmpresa', $dadosEmpresa[0]);        $this->set('entradas', $entradas);        $this->set('despesas', $despesas);        $this->set('dataInicio', $dataInicio);        $this->set('dataFim', $dataFim);        $this->render();    }    public final function filtrar() {        $this->layout = 'null';        $despesas = array();        $dataInicio = Utils::convertData($_POST['data_inicio']);        $dataFim = Utils::convertData($_POST['data_fim']);        $funcionarioId = $_POST['funcionario_id'];        $entradas = $this->Financeiro->filtrar($this->empresas_id, $funcionarioId, $dataInicio, $dataFim, array(2, 3, 4, 5));        if (empty($dataInicio)) {            $dataInicio = 0;        }        if (empty($dataFim)) {            $dataFim = 0;        }        if (empty($funcionarioId)) {            $despesas = $this->Despesa->filtrar($this->empresas_id, $dataInicio, $dataFim);            $funcionarioId = 0;        }        $urlPDF = "http://snappypdf.com.br/gerar.php?url=" . Router::url(array('Financeiros', 'imprimir', $funcionarioId, $this->empresas_id, $this->returnDate($dataInicio), $this->returnDate($dataFim)));        $this->set('entradas', $entradas);        $this->set('despesas', $despesas);        $this->set('urlPDF', $urlPDF);        $this->render();    }    private function returnDate($data) {        if (!empty($data)) {            $data = explode(' ', $data);            $data = $data[0];        }        return $data;    }}