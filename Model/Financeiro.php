<?phpclass Financeiro extends AppModel{	public $useTable = null;		public $name = "Financeiro";		public $primaryKey = "id";		public $validate = array();	public function filtrar( $empresasId, $pessoasId = null, $dataInicio = null, $dataFim = null, $tipo_pagamento = null ){		try{					$PESSOA = NULL;			$DATA   = NULL;			$TIPOPAGAMENTO   = NULL;			if(!empty($pessoasId)){				$PESSOA = " AND Calendar.pessoas_id = {$pessoasId} ";			}			if( !empty($tipo_pagamento) ){				$TIPOPAGAMENTO = " AND Calendar.tipos_pagamentos_id in (".join(',', $tipo_pagamento).") ";			}			if( !empty($dataInicio) && !empty($dataFim) ){				$DATA = " AND DATE(Calendar.start) BETWEEN DATE('{$dataInicio}') AND DATE('{$dataFim}') ";			} else if( !empty($dataInicio) && empty($dataFim) ){				$DATA = " AND DATE(Calendar.start) BETWEEN DATE('{$dataInicio}') AND DATE('{$dataInicio}') ";			}					$sql = "SELECT 						Calendar.id,						Calendar.start,						Calendar.valor_total,						Calendar.desconto,						Calendar.title,						Pessoa.nome AS funcionario,                                                Calendar.pessoas_id,						Funcionario.percentual_comissao AS percentual_comissao,                                                Funcionario.salario 					FROM						fullcalendar AS Calendar							INNER JOIN						pessoas AS Pessoa ON Pessoa.id = Calendar.pessoas_id							LEFT JOIN						funcionarios AS Funcionario ON Funcionario.pessoas_id = Calendar.pessoas_id					WHERE						Calendar.empresas_id = {$empresasId}							AND Calendar.status = TRUE							".$TIPOPAGAMENTO."							".$PESSOA."							". $DATA ."					ORDER BY Calendar.start , Pessoa.nome ASC					;";			return $this->query($sql);		} catch( Exception $ex ){			throw $ex;		}	}}